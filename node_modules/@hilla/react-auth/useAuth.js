import{jsx as U}from"react/jsx-runtime";import{login as C,logout as w}from"@hilla/frontend";import{createContext as P,useContext as F,useEffect as G,useReducer as S}from"react";const c="LOGIN_FETCH",l="LOGIN_SUCCESS",h="LOGIN_FAILURE",A="LOGOUT";function O(e,t){async function o(){e({type:c});const n=await t();e(n?{user:n,type:l}:{error:"Not authenticated",type:h})}return o}function x(e){return()=>{e({type:A})}}const g={initializing:!0,loading:!1};function E(e,t){switch(t.type){case c:return{initializing:!1,loading:!0};case l:return{initializing:!1,loading:!1,user:t.user};case h:return{initializing:!1,loading:!1,error:t.error};case A:return{initializing:!1,loading:!1};default:return e}}const d=P({state:g,login(){throw new Error("AuthContext not initialized")},logout(){throw new Error("AuthContext not initialized")},hasAccess(){throw new Error("AuthContext not initialized")}}),v=e=>{const t=e;return Array.isArray(t.roles)?t.roles:[]};function I({children:e,getAuthenticatedUser:t,config:o}){const[n,s]=S(E,g),u=O(s,t),f=x(s);async function p(r,a){const i=await C(r,a);return i.error||await u(),i}async function y(){await w(),f()}function T(r){if(!(r.requiresLogin??r.rolesAllowed))return!0;if(!n.user)return!1;if(r.rolesAllowed){const i=o?.getRoles?o.getRoles(n.user):v(n.user);return r.rolesAllowed.some(R=>i.includes(R))}return!0}G(()=>{u().catch(()=>{})},[]);const L={state:n,login:p,logout:y,hasAccess:T};return U(d.Provider,{value:L,children:e})}function _(){return F(d)}function N(e,t){function o({children:n}){return U(I,{getAuthenticatedUser:e,config:t,children:n})}return{AuthProvider:o,useAuth:_}}export{d as AuthContext,N as configureAuth};
//# sourceMappingURL=useAuth.js.map
