import{noChange as S,nothing as M}from"lit";import{directive as V,Directive as k,PartType as f}from"lit/directive.js";import{getBinderNode as C}from"./BinderNode.js";import{_fromString as A,ArrayModel as F,BooleanModel as P,hasFromString as w,ObjectModel as g}from"./Models.js";import{_validity as B,defaultValidity as v}from"./Validity.js";const L=["required","invalid","errorMessage","value","validity","checkValidity"];function $(t){return L.some(e=>e in t)}class b{model;#e;#t=v;constructor(e,n){this.#e=e,this.model=n}get element(){return this.#e}set element(e){this.#e=e}get value(){return this.#e.value}set value(e){this.#e.value=e}set errorMessage(e){}get validity(){return this.#e.validity??this.#t}checkValidity(){if(!this.#e.checkValidity)return!0;const e=this.#e.checkValidity();return this.#t={...v,valid:e,...e?{}:this.#i()},e}setAttribute(e,n){n?this.#e.setAttribute(e,""):this.#e.removeAttribute(e)}removeEventListeners(){}#i(){if(!("inputElement"in this.#e))return{customError:!0};const e=this.#e.inputElement;return this.#e.value===""?e.value===""?{valueMissing:!0}:{badInput:!0}:{customError:!0}}}class y extends b{#e=!1;#t=this.#i.bind(this);constructor(e,n){super(e,n),e.addEventListener("validated",this.#t)}set required(e){this.element.required=e}set invalid(e){this.#e=e,this.element.invalid=e}set errorMessage(e){this.element.errorMessage=e}removeEventListeners(){this.element.removeEventListener("validated",this.#t)}#i(e){if(!(e instanceof CustomEvent)||typeof e.detail!="object")return;const n=!e.detail.valid;this.#e!==n&&(this.element.invalid=this.#e)}}class d extends b{set required(e){this.setAttribute("required",e)}set invalid(e){this.setAttribute("invalid",e)}}class p extends d{get value(){return this.model instanceof P?this.element.checked:this.element.checked?this.element.value:void 0}set value(e){this.element.checked=/^(true|on)$/iu.test(String(e))}}class q extends y{get value(){if(this.model&&(this.model instanceof g||this.model instanceof F)){const{selectedItem:e}=this.element;return e??void 0}return super.value}set value(e){this.model instanceof g||this.model instanceof F?this.element.selectedItem=e??null:super.value=e}}class N extends y{get value(){return this.element.selectedItems}set value(e){this.element.selectedItems=e}}class I extends d{get value(){return this.element.selected}set value(e){this.element.selected=e}}function G(t,e){switch(t.localName){case"vaadin-checkbox":case"vaadin-radio-button":return new p(t,e);case"vaadin-combo-box":return new q(t,e);case"vaadin-list-box":return new I(t,e);case"vaadin-multi-select-combo-box":return new N(t,e);case"vaadin-rich-text-editor":return new d(t,e);default:return t.localName==="input"&&/^(checkbox|radio)$/u.test(t.type)?new p(t,e):t.constructor.version?new y(t,e):new d(t,e)}}function x(t,e){return typeof e=="string"&&w(t)?t[A](e):e}const U=V(class extends k{fieldState;constructor(t){if(super(t),t.type!==f.PROPERTY&&t.type!==f.ELEMENT)throw new Error('Use as "<element {field(...)}" or <element ...={field(...)}"')}render(t,e){return M}update(t,[e,n]){const r=t.element,l=C(e);if(!this.fieldState){const a={errorMessage:"",name:"",value:"",required:!1,invalid:!1,model:e,validity:v,element:r,strategy:l.binder.getFieldStrategy(r,e)};this.fieldState=a;const T=()=>{a.strategy.checkValidity(),a.strategy.validity.badInput||(a.value=a.strategy.value),a.validity=a.strategy.validity,l[B]=a.validity,l.value=x(e,a.value),n!==void 0&&n.call(r,r)};r.addEventListener("input",T);const h=()=>{T(),l.visited=!0};r.addEventListener("blur",h),r.addEventListener("change",h)}const{fieldState:i}=this;(i.element!==r||i.model!==e)&&(i.strategy=l.binder.getFieldStrategy(r,e));const{name:o}=l;o!==i.name&&(i.name=o,r.setAttribute("name",o));const{value:s}=l,E=x(e,i.value);s!==E&&!(Number.isNaN(s)&&Number.isNaN(E))&&(i.value=s,i.strategy.value=s);const{required:u}=l;u!==i.required&&(i.required=u,i.strategy.required=u);const c=l.ownErrors[0]?.message||"";c!==i.errorMessage&&(i.errorMessage=c,i.strategy.errorMessage=c);const{invalid:m}=l;return m!==i.invalid&&(i.invalid=m,i.strategy.invalid=m),S}});export{b as AbstractFieldStrategy,p as CheckedFieldStrategy,q as ComboBoxFieldStrategy,d as GenericFieldStrategy,N as MultiSelectComboBoxFieldStrategy,I as SelectedFieldStrategy,y as VaadinFieldStrategy,U as field,G as getDefaultFieldStrategy,$ as isFieldElement};
//# sourceMappingURL=Field.js.map
