import c from"@hilla/generator-typescript-utils/createSourceFile.js";import p from"@hilla/generator-typescript-utils/dependencies/DependencyManager.js";import m from"@hilla/generator-typescript-utils/dependencies/PathManager.js";import d from"@hilla/generator-typescript-utils/memoize.js";import s from"typescript";const l="EndpointRequestInit";class T{#e=new p(new m({extension:".js"}));#t;#r;#s;constructor(e,t){this.#t=t,this.#r=e;const{imports:n,paths:r}=this.#e;this.#e.imports.fromCode(e),this.#s=d(()=>n.named.add(r.createBareModulePath("@hilla/frontend",!1),"Subscription"))}process(){const e=this.#r.statements.filter(r=>!s.isImportDeclaration(r)).map(r=>{if(s.isFunctionDeclaration(r)){const o=r.name?.text;if(o&&this.#t.methodsToPatch.includes(o))return this.#i(r)}return r});let t=this.#e.imports.toCode();if(this.#t.removeInitImport){const r=t.find(o=>s.isImportDeclaration(o)&&o.moduleSpecifier.text==="@hilla/frontend");if(r){const o=this.#o(r);o&&(t=t.map(a=>a===r?o:a))}}const n=[...t,...e];return c(n,this.#r.fileName)}#n(e){return e[e.length-1].type.typeName.text===l}#o=e=>{const t=e.importClause?.namedBindings;if(t&&s.isNamedImports(t)){const n=t.elements.filter(o=>o.name.text!=="EndpointRequestInit"),r=s.factory.updateImportClause(e.importClause,!1,void 0,s.factory.createNamedImports(n));return s.factory.updateImportDeclaration(e,void 0,r,e.moduleSpecifier,void 0)}};#a(e){const t=e.type.typeArguments[0],n=s.isUnionTypeNode(t)?t.types[0]:t;return s.factory.createTypeReferenceNode(this.#s(),n.typeArguments)}#i(e){const{parameters:t}=e,n=this.#n(t);return s.factory.createFunctionDeclaration(void 0,e.asteriskToken,e.name,e.typeParameters,n?t.slice(0,-1):t,this.#a(e),this.#c(e,n))}#c(e,t){const n=e.body.statements[0],{arguments:r,expression:o,typeArguments:a}=n.expression,i=o;return s.factory.createBlock([s.factory.createReturnStatement(s.factory.createCallExpression(s.factory.createPropertyAccessExpression(i.expression,s.factory.createIdentifier("subscribe")),a,t?r.slice(0,-1):r))])}}export{T as PushProcessor};
//# sourceMappingURL=PushProcessor.js.map
