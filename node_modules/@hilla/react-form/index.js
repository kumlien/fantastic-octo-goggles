import{_fromString as y,_validity as V,BinderRoot as c,CHANGED as M,getBinderNode as o,getDefaultFieldStrategy as g,hasFromString as p,isFieldElement as b}from"@hilla/form";import{useEffect as E,useMemo as u,useReducer as F,useRef as R}from"react";const s=window;s.Vaadin??={},s.Vaadin.registrations??=[],s.Vaadin.registrations.push({is:"@hilla/react-form",version:"2.3.2"});function w(){const[t,r]=F(i=>i+1,0);return r}function v(t,r){return typeof r=="string"&&p(t)?t[y](r):r}function m(t){return{addValidator:t.addValidator.bind(t),defaultValue:t.defaultValue,dirty:t.dirty,errors:t.errors,invalid:t.invalid,model:t.model,name:t.name,ownErrors:t.ownErrors,required:t.required,setValidators(r){t.validators=r},setValue(r){t.value=r},setVisited(r){t.visited=r},validate:t.validate.bind(t),validators:t.validators,value:t.value,visited:t.visited}}function f(t){return u(()=>{const r=new WeakMap;return i=>{const a=o(i);let e=r.get(i);if(e||(e={element:void 0,errorMessage:"",invalid:!1,markVisited(){a.visited=!0},ref(l){if(!l){e.element?.removeEventListener("change",e.updateValue),e.element?.removeEventListener("input",e.updateValue),e.element?.removeEventListener("blur",e.markVisited),e.strategy?.removeEventListeners(),e.element=void 0,e.strategy=void 0;return}if(!b(l))throw new TypeError(`Element '${l.localName}' is not a form element`);e.element!==l&&(e.element=l,e.element.addEventListener("change",e.updateValue),e.element.addEventListener("input",e.updateValue),e.element.addEventListener("blur",e.markVisited),e.strategy=g(l,i))},required:!1,strategy:void 0,updateValue(){e.strategy&&(e.strategy.invalid=!1,e.strategy.checkValidity(),e.strategy.validity.badInput||(e.value=e.strategy.value),a[V]=e.strategy.validity,a.value=v(i,e.value))},value:void 0},r.set(i,e)),e.strategy){const l=v(i,e.value);l!==a.value&&!(Number.isNaN(a.value)&&Number.isNaN(l))&&(e.value=a.value,e.strategy.value=a.value),e.required!==a.required&&(e.required=a.required,e.strategy.required=a.required);const d=a.ownErrors.at(0)?.message??"";e.errorMessage!==d&&(e.errorMessage=d,e.strategy.errorMessage=d),e.invalid=a.invalid,e.strategy.invalid=a.invalid}return{name:a.name,ref:e.ref}}},[t])}function x(t,r){const i=R({});i.current.onSubmit=r?.onSubmit,i.current.onChange=r?.onChange;const a=w(),e=u(()=>new c(t,i.current),[t]),l=f(e);return E(()=>{e.addEventListener(M.type,a)},[e]),{...m(e),clear:e.clear.bind(e),field:l,read:e.read.bind(e),reset:e.reset.bind(e),setDefaultValue(n){e.defaultValue=n},setValue(n){e.value=n},submit:e.submit.bind(e),value:e.value}}function h(t){const r=o(t),i=f(r);return{...m(r),field:i}}export{x as useForm,h as useFormPart};
//# sourceMappingURL=index.js.map
