import{convertReferenceSchemaToPath as T,convertReferenceSchemaToSpecifier as g,decomposeSchema as w,isArraySchema as x,isBooleanSchema as P,isComposedSchema as I,isIntegerSchema as K,isMapSchema as A,isNullableSchema as $,isNumberSchema as B,isReferenceSchema as E,isStringSchema as _}from"@hilla/generator-typescript-core/Schema.js";import r from"typescript";import{MetadataProcessor as C}from"./MetadataProcessor.js";import{createModelBuildingCallback as D,importBuiltInFormModel as a}from"./utils.js";import{hasValidationConstraints as j,ValidationConstraintProcessor as k}from"./ValidationConstraintProcessor.js";const o=Symbol(),n=Symbol(),s=Symbol(),i=Symbol(),d=Symbol(),p=Symbol(),y=Symbol(),m=Symbol(),u=Symbol(),N=Symbol();class l{[o];[u];[N];constructor(e,t){this[o]=t,this[u]=e,this[N]=I(e)?w(e)[0]:e}process(){const e=this[N];return E(e)?this[i](e):x(e)?this[n](e):A(e)?this[s](e):_(e)?this[d](e):B(e)||K(e)?this[p](e):P(e)?this[y](e):this[m](e)}}class f extends l{[n](e){return r.factory.createTypeReferenceNode(r.factory.createIdentifier("ReadonlyArray"),[new f(e.items,this[o]).process()])}[y](e){return r.factory.createKeywordTypeNode(r.SyntaxKind.BooleanKeyword)}[p](e){return r.factory.createKeywordTypeNode(r.SyntaxKind.NumberKeyword)}[s]({additionalProperties:e}){const t=typeof e=="boolean"?r.factory.createKeywordTypeNode(r.SyntaxKind.AnyKeyword):new f(e,this[o]).process();return r.factory.createTypeReferenceNode(r.factory.createIdentifier("Record"),[r.factory.createKeywordTypeNode(r.SyntaxKind.StringKeyword),t])}[i](e){const{imports:t,paths:c}=this[o],h=g(e),S=c.createRelativePath(T(e));return r.factory.createTypeReferenceNode(t.default.getIdentifier(S)??t.default.add(S,h,!0))}[d](e){return r.factory.createKeywordTypeNode(r.SyntaxKind.StringKeyword)}[m](e){return r.factory.createKeywordTypeNode(r.SyntaxKind.UnknownKeyword)}}class v extends l{[n](e){return a("ArrayModel",this[o])}[y](e){return a("BooleanModel",this[o])}[p](e){return a("NumberModel",this[o])}[s](e){return a("ObjectModel",this[o])}[i](e){const{imports:t,paths:c}=this[o],h=`${g(e)}Model`,S=c.createRelativePath(`${T(e)}Model`);return t.default.getIdentifier(S)??t.default.add(S,h)}[d](e){return a("StringModel",this[o])}[m](e){return a("ObjectModel",this[o])}}class b extends l{#e;constructor(e,t){super(e,t),this.#e=new v(e,t)}[n](e){return r.factory.createTypeReferenceNode(this.#e[n](e),[new b(e.items,this[o]).process()])}[y](e){return r.factory.createTypeReferenceNode(this.#e[y](e))}[p](e){return r.factory.createTypeReferenceNode(this.#e[p](e))}[s](e){return r.factory.createTypeReferenceNode(this.#e[s](e),[new f(e,this[o]).process()])}[i](e){return r.factory.createTypeReferenceNode(this.#e[i](e))}[d](e){return r.factory.createTypeReferenceNode(this.#e[d](e))}[m](e){return r.factory.createTypeReferenceNode(this.#e[m](e),[r.factory.createKeywordTypeNode(r.SyntaxKind.UnknownKeyword)])}}class R extends l{#e;#r;constructor(e,t){super(e,t),this.#e=new k(c=>a(c,t)),this.#r=new C}process(){const e=this[u];let t=super.process();const c=[this.#t(e),this.#o(e)].filter(Boolean);if(c.length>0){const h=r.factory.createObjectLiteralExpression(c);t=[...t,h]}return[$(e)?r.factory.createTrue():r.factory.createFalse(),...t]}[n](e){const t=new v(e.items,this[o]).process();return[D(t,new R(e.items,this[o]).process())]}[y](e){return[]}[p](e){return[]}[s](e){return[]}[i](e){return[]}[d](e){return[]}[m](e){return[]}#t(e){if(!j(e))return null;const t=e["x-validation-constraints"].map(c=>this.#e.process(c));return r.factory.createPropertyAssignment("validators",r.factory.createArrayLiteralExpression(t))}#o(e){const t=this.#r.process(e);return t?r.factory.createPropertyAssignment("meta",t):null}}export{R as ModelSchemaExpressionProcessor,l as ModelSchemaPartProcessor,b as ModelSchemaTypeProcessor};
//# sourceMappingURL=ModelSchemaProcessor.js.map
