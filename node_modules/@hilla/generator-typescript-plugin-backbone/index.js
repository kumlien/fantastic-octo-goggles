import a from"@hilla/generator-typescript-core/Plugin.js";import c from"./EndpointProcessor.js";import{EntityProcessor as l}from"./EntityProcessor.js";var m=(e=>(e.Endpoint="endpoint",e.Entity="entity",e))(m||{});class d extends a{static BACKBONE_PLUGIN_FILE_TAGS="BACKBONE_PLUGIN_FILE_TAGS";#e=new WeakMap;get path(){return import.meta.url}async execute(o){const e=await this.#t(o),r=this.#o(o);e.forEach(t=>this.#e.set(t,"endpoint")),r.forEach(t=>this.#e.set(t,"entity")),o.sources.push(...e,...r),o.pluginStorage.set(this.constructor.BACKBONE_PLUGIN_FILE_TAGS,this.#e)}async#t(o){this.logger.debug("Processing endpoints");const e=new Map;Object.entries(o.api.paths).filter(([,t])=>!!t).forEach(([t,n])=>{const[,i,p]=t.split("/");let s;e.has(i)?s=e.get(i):(s=new Map,e.set(i,s)),s.set(p,n)});const r=await Promise.all([...e.entries()].map(async([t,n])=>c.create(t,this,n,o.outputDir)));return Promise.all(r.map(async t=>t.process()))}#o(o){return this.logger.debug("Processing entities"),o.api.components?.schemas?Object.entries(o.api.components.schemas).map(([e,r])=>new l(e,r,this).process()):[]}}export{m as BackbonePluginSourceType,d as default};
//# sourceMappingURL=index.js.map
