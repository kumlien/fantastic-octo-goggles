{
  "version": 3,
  "sources": ["src/EndpointProcessor.ts"],
  "sourcesContent": ["import type Plugin from '@hilla/generator-typescript-core/Plugin.js';\nimport ClientPlugin from '@hilla/generator-typescript-plugin-client';\nimport createSourceFile from '@hilla/generator-typescript-utils/createSourceFile.js';\nimport DependencyManager from '@hilla/generator-typescript-utils/dependencies/DependencyManager.js';\nimport PathManager from '@hilla/generator-typescript-utils/dependencies/PathManager.js';\nimport { OpenAPIV3 } from 'openapi-types';\nimport type { ReadonlyDeep } from 'type-fest';\nimport type { SourceFile, Statement } from 'typescript';\nimport EndpointMethodOperationProcessor, {\n  HILLA_FRONTEND_NAME,\n  INIT_TYPE_NAME,\n} from './EndpointMethodOperationProcessor.js';\n\nexport default class EndpointProcessor {\n  static async create(\n    name: string,\n    owner: Plugin,\n    methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>,\n    outputDir?: string,\n  ): Promise<EndpointProcessor> {\n    const endpoint = new EndpointProcessor(name, owner, methods, outputDir);\n    endpoint.#dependencies.imports.default.add(\n      endpoint.#dependencies.paths.createRelativePath(await ClientPlugin.getClientFileName(outputDir)),\n      'client',\n    );\n    endpoint.#dependencies.imports.named.add(\n      endpoint.#dependencies.paths.createBareModulePath(HILLA_FRONTEND_NAME),\n      INIT_TYPE_NAME,\n    );\n    return endpoint;\n  }\n\n  readonly #createdFilePaths = new PathManager({ extension: 'ts' });\n  readonly #dependencies = new DependencyManager(new PathManager({ extension: '.js' }));\n  readonly #methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>;\n  readonly #name: string;\n  readonly #outputDir: string | undefined;\n  readonly #owner: Plugin;\n\n  private constructor(\n    name: string,\n    owner: Plugin,\n    methods: Map<string, ReadonlyDeep<OpenAPIV3.PathItemObject>>,\n    outputDir?: string,\n  ) {\n    this.#name = name;\n    this.#owner = owner;\n    this.#methods = methods;\n    this.#outputDir = outputDir;\n  }\n\n  async process(): Promise<SourceFile> {\n    this.#owner.logger.debug(`Processing endpoint: ${this.#name}`);\n\n    const statements = (\n      await Promise.all(Array.from(this.#methods, async ([method, pathItem]) => this.#processMethod(method, pathItem)))\n    ).flatMap((item) => item);\n\n    const { exports, imports } = this.#dependencies;\n\n    return createSourceFile(\n      [...imports.toCode(), ...statements, ...exports.toCode()],\n      this.#createdFilePaths.createRelativePath(this.#name),\n    );\n  }\n\n  async #processMethod(\n    method: string,\n    pathItem: ReadonlyDeep<OpenAPIV3.PathItemObject>,\n  ): Promise<readonly Statement[]> {\n    this.#owner.logger.debug(`Processing endpoint method: ${this.#name}.${method}`);\n\n    return (\n      await Promise.all(\n        Object.values(OpenAPIV3.HttpMethods)\n          .filter((httpMethod) => pathItem[httpMethod])\n          .map(\n            async (httpMethod) =>\n              EndpointMethodOperationProcessor.createProcessor(\n                httpMethod,\n                this.#name,\n                method,\n                pathItem[httpMethod]!,\n                this.#dependencies,\n                this.#owner,\n              )?.process(this.#outputDir),\n          ),\n      )\n    ).filter(Boolean) as readonly Statement[];\n  }\n}\n"],
  "mappings": "AACA,OAAOA,MAAkB,4CACzB,OAAOC,MAAsB,wDAC7B,OAAOC,MAAuB,sEAC9B,OAAOC,MAAiB,gEACxB,OAAS,aAAAC,MAAiB,gBAG1B,OAAOC,GACL,uBAAAC,EACA,kBAAAC,MACK,wCAEP,MAAOC,CAAgC,CACrC,aAAa,OACXC,EACAC,EACAC,EACAC,EAC4B,CAC5B,MAAMC,EAAW,IAAIL,EAAkBC,EAAMC,EAAOC,EAASC,CAAS,EACtE,OAAAC,EAASC,GAAc,QAAQ,QAAQ,IACrCD,EAASC,GAAc,MAAM,mBAAmB,MAAMd,EAAa,kBAAkBY,CAAS,CAAC,EAC/F,QACF,EACAC,EAASC,GAAc,QAAQ,MAAM,IACnCD,EAASC,GAAc,MAAM,qBAAqBR,CAAmB,EACrEC,CACF,EACOM,CACT,CAESE,GAAoB,IAAIZ,EAAY,CAAE,UAAW,IAAK,CAAC,EACvDW,GAAgB,IAAIZ,EAAkB,IAAIC,EAAY,CAAE,UAAW,KAAM,CAAC,CAAC,EAC3Ea,GACAC,GACAC,GACAC,GAED,YACNV,EACAC,EACAC,EACAC,EACA,CACA,KAAKK,GAAQR,EACb,KAAKU,GAAST,EACd,KAAKM,GAAWL,EAChB,KAAKO,GAAaN,CACpB,CAEA,MAAM,SAA+B,CACnC,KAAKO,GAAO,OAAO,MAAM,wBAAwB,KAAKF,EAAK,EAAE,EAE7D,MAAMG,GACJ,MAAM,QAAQ,IAAI,MAAM,KAAK,KAAKJ,GAAU,MAAO,CAACK,EAAQC,CAAQ,IAAM,KAAKC,GAAeF,EAAQC,CAAQ,CAAC,CAAC,GAChH,QAASE,GAASA,CAAI,EAElB,CAAE,QAAAC,EAAS,QAAAC,CAAQ,EAAI,KAAKZ,GAElC,OAAOb,EACL,CAAC,GAAGyB,EAAQ,OAAO,EAAG,GAAGN,EAAY,GAAGK,EAAQ,OAAO,CAAC,EACxD,KAAKV,GAAkB,mBAAmB,KAAKE,EAAK,CACtD,CACF,CAEA,KAAMM,GACJF,EACAC,EAC+B,CAC/B,YAAKH,GAAO,OAAO,MAAM,+BAA+B,KAAKF,EAAK,IAAII,CAAM,EAAE,GAG5E,MAAM,QAAQ,IACZ,OAAO,OAAOjB,EAAU,WAAW,EAChC,OAAQuB,GAAeL,EAASK,CAAU,CAAC,EAC3C,IACC,MAAOA,GACLtB,EAAiC,gBAC/BsB,EACA,KAAKV,GACLI,EACAC,EAASK,CAAU,EACnB,KAAKb,GACL,KAAKK,EACP,GAAG,QAAQ,KAAKD,EAAU,CAC9B,CACJ,GACA,OAAO,OAAO,CAClB,CACF",
  "names": ["ClientPlugin", "createSourceFile", "DependencyManager", "PathManager", "OpenAPIV3", "EndpointMethodOperationProcessor", "HILLA_FRONTEND_NAME", "INIT_TYPE_NAME", "EndpointProcessor", "name", "owner", "methods", "outputDir", "endpoint", "#dependencies", "#createdFilePaths", "#methods", "#name", "#outputDir", "#owner", "statements", "method", "pathItem", "#processMethod", "item", "exports", "imports", "httpMethod"]
}
